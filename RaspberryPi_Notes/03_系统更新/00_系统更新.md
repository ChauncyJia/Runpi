# 系统更新
## 通过Putty SSH连接树莓派
- 打开Putty，输入树莓派的IP 用户名 密码进入系统
## 系统更新
- 系统更新
  - sudo service packagekit restart (重启Packagekit服务)
  - sudo apt update
  - sudo apt full-upgrade
- 打开VNC
  - sudo raspi-config
  - 选择interface，打开VNC server
- 树莓派更换清华源
  - [https://mirrors.tuna.tsinghua.edu.cn/help/debian/]源网址
  - sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup
  - sudo nano /etc/apt/sources.list
  - 在打开的文件中，将所有的 deb 和 deb-src 行替换为以下内容：
  - [上述网站内容]
  - cat /etc/apt/sources.list
  - sudo apt update
  - sudo apt full-upgrade
- 打开serial
  - sudo raspi-config
  - 选择interface，关闭serial 启动，打开是serial硬件
- 安装XRDP
  - sudo apt install xrdp
  - sudo apt update
  - sudo apt full-upgrade
  - sudo apt autoremove
- 解决XRDP浏览器花屏
  - sudo adduser xrdp ssl-cert
  - sudo nano /etc/X11/xrdp/xorg.conf
  - 并找到行 Option "DRMDevice" "/dev/dri/renderD128" 行并将其更改Option “DRMDevice” “”
  - sudo reboot
- 解决XRDP 点击wifi需要验证
  - sudo nano /etc/polkit-1/localauthority/50-local.d/47-allow-wifi-scans.pkla
  - 在打开的编辑器中，复制并粘贴以下内容：
  - [Allow Wifi Scan]
Identity=unix-user:*
Action=org.freedesktop.NetworkManager.wifi.scan;org.freedesktop.NetworkManager.enable-disable-wifi;org.freedesktop.NetworkManager.settings.modify.own;org.freedesktop.NetworkManager.settings.modify.system;org.freedesktop.NetworkManager.network-control
ResultAny=yes
ResultInactive=yes
ResultActive=yes
  - sudo reboot
- 解决XRDP 系统仓库需要认证
  - sudo nano /etc/polkit-1/localauthority/50-local.d/46-allow-update-repo.pkla
  - 然后添加以下内容：
  - [Allow Refresh Repository all Users]
Identity=unix-user:*
Action=org.freedesktop.packagekit.system-sources-refresh
ResultAny=yes
ResultInactive=yes
ResultActive=yes
- 解决xrdp 桌面thinclient_drives 
  - sudo umount thinclient_drives
  - sudo rm -rf thinclient_drives
  - sudo nano /etc/xrdp/sesman.ini更改 FuseMountName 的值
  - FuseMountName=.xrdp/thinclient_drives
- 管理磁盘情况
  - df -h #检查磁盘使用大小
  - sudo apt clean #清理包文件
  - sudo apt remove xxx  卸载软件包
  - sudo apt purge xxx  卸载软件包和配置rpi
- 安装wiringPi库
  - git clone https://github.com/WiringPi/WiringPi.git
cd WiringPi
./build
- 安装gpiozero库
  - sudo apt install python3-gpiozero
- 安装samba用于文件共享
  - sudo apt-get install samba samba-common-bin
  - sudo nano /etc/samba/smb.conf
  - 最后一行增加 
  ```
  [PiCode]
    comment = PiCode
    path = /home/abc/Desktop
    valid users = abc
    public = yes
    browseable = yes
    read only = no
    available = yes
  ```
  - sudo smbpasswd -a abc
  - 输入密码
  - 在PC端文件管理器输入IP进入树莓派系统